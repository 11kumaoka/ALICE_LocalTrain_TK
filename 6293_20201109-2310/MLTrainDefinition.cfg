#_______________________________________________________________________________
#Module.Begin        CDBConnectTask
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGPP/PilotTrain/AddTaskCDBconnect.C
#Module.MacroArgs    
#Module.Deps         
#Module.Owner        mfasel
#Module.OutputFile   EventStat_temp.root
#Module.StartConfig
__R_ADDTASK__->SetFallBackToRaw(kTRUE);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        ConfigureEmbeddingHelper_2018_Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWG/EMCAL/macros/ConfigureEmcalEmbeddingHelperOnLEGOTrain.C
#Module.MacroArgs    
#Module.Deps         EmbeddingHelper_2018_Kuma
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);

//__R_ADDTASK__->SetPtHardBin(kPtHardBin);
__R_ADDTASK__->SetNPtHardBins(1);
__R_ADDTASK__->SetFilePattern("alien:///alice/sim/2020/LHC20g4/%d/");
//__R_ADDTASK__->SetInputFilename("*/AOD/*/aod_archive.zip");
//__R_ADDTASK__->SetInputFilename("*/AOD200/*/AliAOD.root");
__R_ADDTASK__->SetInputFilename("*/AOD/*/AliAOD.root");
__R_ADDTASK__->SetTriggerMask(AliVEvent::kAny); // Equivalent to 0

__R_ADDTASK__->SetRandomFileAccess(kTRUE);
__R_ADDTASK__->SetRandomEventNumberAccess(kTRUE);
//__R_ADDTASK__->SetMCRejectOutliers();
//__R_ADDTASK__->SetPtHardJetPtRejectionFactor(4.);
__R_ADDTASK__->SetZVertexCut(10.);

// Set YAML configuration, including good runlist of embedded events, and internal event selection feature
__R_ADDTASK__->SetConfigurationPath("alien:///alice/cern.ch/user/t/tkumaoka/embeddingHelperConfiguration.yaml");

// Set the pt hard auto config identifier
__R_ADDTASK__->SetAutoConfigureIdentifier("2020Oct28Kuma");

// Ensure that the internal and external event acceptances are similar (within 4 cm)
// Do _not_ use this option - it wastes too many embedded events and never finishes!
//__R_ADDTASK__->SetMaxVertexDistance(4);

// It is very important to call Initialize() with true!
__R_ADDTASK__->Initialize(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        ConfigureEmcalCorrectionTask_Embedding_2018_Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWG/EMCAL/macros/ConfigureEmcalCorrectionTaskOnLEGOTrain.C
#Module.MacroArgs    
#Module.Deps         EmcalCorrectionTask_Embedding_CellLevel_Kuma,EmcalCorrectionTask_Embedding_ClusterLevel_Kuma
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUserConfigurationFilename("alien:///alice/cern.ch/user/t/tkumaoka/userJetEmbedding.yaml");
__R_ADDTASK__->Initialize(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        EmbeddingHelper_2018_Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWG/EMCAL/macros/AddTaskEmcalEmbeddingHelper.C
#Module.MacroArgs    
#Module.Deps         CDBConnectTask,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetRandomFileAccess(kTRUE);

// Setup pt hard autoconfiguration
// The configure wagon should still set the identifier!
__R_ADDTASK__->SetAutoConfigurePtHardBins(true);
//__R_ADDTASK__->SetAutoConfigureBasePath("alien:///alice/cern.ch/user/a/alitrain/");
__R_ADDTASK__->SetAutoConfigureBasePath("/home/alitrain/train-workdir/");
__R_ADDTASK__->SetAutoConfigureTrainTypePath("PWGJE/Jets_EMC_PbPb/");

// DO NOT call Initialize() here!
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        EmcalCorrectionTask_Embedding_CellLevel_Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWG/EMCAL/macros/AddTaskEmcalCorrectionTask.C
#Module.MacroArgs    
#Module.Deps         EmbeddingHelper_2018_Kuma
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetUseNewCentralityEstimation(kIsRun2);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SetForceBeamType(AliEmcalCorrectionTask::kAA);

//Do not call Initialize() here! Instead, call it in the configure macro. See the wagon "ConfigureEmcalCorrectionTask_Embedding"
//__R_ADDTASK__->Initialize();
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        EmcalCorrectionTask_Embedding_ClusterLevel_Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWG/EMCAL/macros/AddTaskEmcalCorrectionTask.C
#Module.MacroArgs    
#Module.Deps         EmcalCorrectionTask_Embedding_CellLevel_Kuma
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetUseNewCentralityEstimation(kIsRun2);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SetForceBeamType(AliEmcalCorrectionTask::kAA);

//Do not call Initialize() here! Instead, call it in the configure macro. See the wagon "ConfigureEmcalCorrectionTask_Embedding"
//__R_ADDTASK__->Initialize();
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_charged_AKT_02_detLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "usedefault", AliJetContainer::antikt_algorithm, 0.2, AliJetContainer::kChargedJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "detLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   EventStat_temp.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);

// Setup the tracks properly to be retrieved from the external event
AliParticleContainer * tracks = __R_ADDTASK__->GetParticleContainer(0);
tracks->SetIsEmbedding(kTRUE);
tracks->SetParticlePtCut(0.15);
__R_ADDTASK__k->AdoptTrackContainer(tracks);


// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Charged_AKT_02_hybridLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "caloClustersCombined", AliJetContainer::antikt_algorithm, 0.2, AliJetContainer::kChargedJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "hybridLevelJets_central", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,JetFinder_charged_AKT_02_detLevelJets_Embedding_MC_2018Kuma,JetFinder_charged_AKT_02_partLevelJets_Embedding_MC_2018Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
// set efficiency of 0.98
__R_ADDTASK__->SetTrackEfficiency(0.98);
__R_ADDTASK__->SetTrackEfficiencyOnlyForEmbedding(kTRUE);
  // If true, events that are not selected in the PbPb will not be used for embedding.
  // This ensures that good embedded events are not wasted on bad PbPb events.
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(kTRUE);
__R_ADDTASK__->SetMinJetArea(0.07);
// set particle container as embedding
AliTrackContainer * tracksEmbedDetLevel = new AliTrackContainer("tracks");
  // Get the det level tracks from the external event!
tracksEmbedDetLevel->SetIsEmbedding(kTRUE);
tracksEmbedDetLevel->SetParticlePtCut(0.15);
__R_ADDTASK__->AdoptTrackContainer(tracksEmbedDetLevel);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_charged_AKT_02_partLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "mcparticles", "", AliJetContainer::antikt_algorithm, 0.2, AliJetContainer::kChargedJet, 0, 0.3, 0.005, AliJetContainer::E_scheme, "partLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);


// Setup the tracks properly to be retrieved from the external event
AliMCParticleContainer * truthTracks = __R_ADDTASK__->GetMCParticleContainer(0);
truthTracks->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_charged_AKT_03_detLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "usedefault", AliJetContainer::antikt_algorithm, 0.3, AliJetContainer::kChargedJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "detLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);

// Setup the tracks properly to be retrieved from the external event
AliParticleContainer * tracks = __R_ADDTASK__->GetParticleContainer(0);
tracks->SetIsEmbedding(kTRUE);
tracks->SetParticlePtCut(0.15);
__R_ADDTASK__k->AdoptTrackContainer(tracks);


// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Charged_AKT_03_hybridLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "caloClustersCombined", AliJetContainer::antikt_algorithm, 0.3, AliJetContainer::kChargedJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "hybridLevelJets_central", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,JetFinder_charged_AKT_03_detLevelJets_Embedding_MC_2018Kuma,JetFinder_charged_AKT_03_partLevelJets_Embedding_MC_2018Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
// set efficiency of 0.98
__R_ADDTASK__->SetTrackEfficiency(0.98);
__R_ADDTASK__->SetTrackEfficiencyOnlyForEmbedding(kTRUE);
  // If true, events that are not selected in the PbPb will not be used for embedding.
  // This ensures that good embedded events are not wasted on bad PbPb events.
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(kTRUE);
__R_ADDTASK__->SetMinJetArea(0.07);
// set particle container as embedding
AliTrackContainer * tracksEmbedDetLevel = new AliTrackContainer("tracks");
  // Get the det level tracks from the external event!
tracksEmbedDetLevel->SetIsEmbedding(kTRUE);
tracksEmbedDetLevel->SetParticlePtCut(0.15);
__R_ADDTASK__->AdoptTrackContainer(tracksEmbedDetLevel);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_charged_AKT_03_partLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "mcparticles", "", AliJetContainer::antikt_algorithm, 0.3, AliJetContainer::kChargedJet, 0, 0.3, 0.005, AliJetContainer::E_scheme, "partLevelJets", 0., kFALSE, kFALSE
#Module.Deps         MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);


// Setup the tracks properly to be retrieved from the external event
AliMCParticleContainer * truthTracks = __R_ADDTASK__->GetMCParticleContainer(0);
truthTracks->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_charged_AKT_04_detLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "usedefault", AliJetContainer::antikt_algorithm, 0.4, AliJetContainer::kChargedJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "detLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);

// Setup the tracks properly to be retrieved from the external event
AliParticleContainer * tracks = __R_ADDTASK__->GetParticleContainer(0);
tracks->SetIsEmbedding(kTRUE);
tracks->SetParticlePtCut(0.15);
__R_ADDTASK__k->AdoptTrackContainer(tracks);


// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Charged_AKT_04_hybridLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "caloClustersCombined", AliJetContainer::antikt_algorithm, 0.4, AliJetContainer::kChargedJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "hybridLevelJets_central", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,JetFinder_charged_AKT_04_detLevelJets_Embedding_MC_2018Kuma,JetFinder_charged_AKT_04_partLevelJets_Embedding_MC_2018Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
// set efficiency of 0.98
__R_ADDTASK__->SetTrackEfficiency(0.98);
__R_ADDTASK__->SetTrackEfficiencyOnlyForEmbedding(kTRUE);
  // If true, events that are not selected in the PbPb will not be used for embedding.
  // This ensures that good embedded events are not wasted on bad PbPb events.
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(kTRUE);
__R_ADDTASK__->SetMinJetArea(0.07);
// set particle container as embedding
AliTrackContainer * tracksEmbedDetLevel = new AliTrackContainer("tracks");
  // Get the det level tracks from the external event!
tracksEmbedDetLevel->SetIsEmbedding(kTRUE);
tracksEmbedDetLevel->SetParticlePtCut(0.15);
__R_ADDTASK__->AdoptTrackContainer(tracksEmbedDetLevel);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_charged_AKT_04_partLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "mcparticles", "", AliJetContainer::antikt_algorithm, 0.4, AliJetContainer::kChargedJet, 0, 0.3, 0.005, AliJetContainer::E_scheme, "partLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);


// Setup the tracks properly to be retrieved from the external event
AliMCParticleContainer * truthTracks = __R_ADDTASK__->GetMCParticleContainer(0);
truthTracks->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_charged_AKT_05_detLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "usedefault", AliJetContainer::antikt_algorithm, 0.5, AliJetContainer::kChargedJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "detLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);

// Setup the tracks properly to be retrieved from the external event
AliParticleContainer * tracks = __R_ADDTASK__->GetParticleContainer(0);
tracks->SetIsEmbedding(kTRUE);
tracks->SetParticlePtCut(0.15);
__R_ADDTASK__k->AdoptTrackContainer(tracks);


// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Charged_AKT_05_hybridLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "caloClustersCombined", AliJetContainer::antikt_algorithm, 0.5, AliJetContainer::kChargedJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "hybridLevelJets_central", 0., kFALSE, kFALSE
#Module.Deps         MultSelectionTask,JetFinder_charged_AKT_05_partLevelJets_Embedding_MC_2018Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,JetFinder_charged_AKT_05_detLevelJets_Embedding_MC_2018Kuma
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
// set efficiency of 0.98
__R_ADDTASK__->SetTrackEfficiency(0.98);
__R_ADDTASK__->SetTrackEfficiencyOnlyForEmbedding(kTRUE);
  // If true, events that are not selected in the PbPb will not be used for embedding.
  // This ensures that good embedded events are not wasted on bad PbPb events.
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(kTRUE);
__R_ADDTASK__->SetMinJetArea(0.07);
// set particle container as embedding
AliTrackContainer * tracksEmbedDetLevel = new AliTrackContainer("tracks");
  // Get the det level tracks from the external event!
tracksEmbedDetLevel->SetIsEmbedding(kTRUE);
tracksEmbedDetLevel->SetParticlePtCut(0.15);
__R_ADDTASK__->AdoptTrackContainer(tracksEmbedDetLevel);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_charged_AKT_05_partLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "mcparticles", "", AliJetContainer::antikt_algorithm, 0.5, AliJetContainer::kChargedJet, 0, 0.3, 0.005, AliJetContainer::E_scheme, "partLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);


// Setup the tracks properly to be retrieved from the external event
AliMCParticleContainer * truthTracks = __R_ADDTASK__->GetMCParticleContainer(0);
truthTracks->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_charged_KT_04_Embedding_Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "", AliJetContainer::kt_algorithm, 0.4, AliJetContainer::kChargedJet, kTrackPtCut, kClusPtCut, kGhostArea, AliJetContainer::pt_scheme, "Jet", 0., kFALSE, kFALSE
#Module.Deps         
#Module.Owner        tkumaoka
#Module.OutputFile   EventStat_temp.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);

__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);

__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_02_detLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "usedefault", AliJetContainer::antikt_algorithm, 0.2, AliJetContainer::kFullJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "detLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);

__R_ADDTASK__->GetClusterContainer(0)->SetClusNonLinCorrEnergyCut(0.);
__R_ADDTASK__->GetClusterContainer(0)->SetClusHadCorrEnergyCut(0.3);
__R_ADDTASK__->GetClusterContainer(0)->SetDefaultClusterEnergy(AliVCluster::kHadCorr);

// Setup the tracks properly to be retrieved from the external event
AliParticleContainer * tracks = __R_ADDTASK__->GetParticleContainer(0);
tracks->SetIsEmbedding(kTRUE);
AliTrackContainer * trackCont = dynamic_cast<AliTrackContainer *>(tracks);
tracks->SetParticlePtCut(0.15);
__R_ADDTASK__k->AdoptTrackContainer(tracks);


AliClusterContainer * clusters = __R_ADDTASK__->GetClusterContainer(0);
clusters->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_02_hybridLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "caloClustersCombined", AliJetContainer::antikt_algorithm, 0.2, AliJetContainer::kFullJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "hybridLevelJets_central", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,JetFinder_Full_AKT_02_detLevelJets_Embedding_MC_2018Kuma,JetFinder_Full_AKT_02_partLevelJets_Embedding_MC_2018Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
// This would be ideal for subwagons, but unfortunately they won't work for the jet finder.
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kIsRun2);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);

// Artificial tracking efficiency derived from the full jet R_AA paper.
// 10-30 \approx .99
// 0-10% \approx .98
// Apply only to embedded particles
__R_ADDTASK__->SetTrackEfficiency(.98);
__R_ADDTASK__->SetTrackEfficiencyOnlyForEmbedding(kTRUE);

// Particle containers
AliTrackContainer * tracksDetLevel = new AliTrackContainer("tracks");
// Get the det level tracks from the external event!
tracksDetLevel->SetIsEmbedding(kTRUE);
tracksDetLevel->SetParticlePtCut(3.);
__R_ADDTASK__->AdoptTrackContainer(tracksDetLevel);

// Cluster containers
__R_ADDTASK__->GetClusterContainer(0)->SetDefaultClusterEnergy(AliVCluster::kHadCorr);
__R_ADDTASK__->GetClusterContainer(0)->SetClusTimeCut(-50e-9, 100e-9);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_02_partLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "mcparticles", "", AliJetContainer::antikt_algorithm, 0.2, AliJetContainer::kFullJet, 0, 0.3, 0.005, AliJetContainer::E_scheme, "partLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);


// Setup the tracks properly to be retrieved from the external event
AliMCParticleContainer * truthTracks = __R_ADDTASK__->GetMCParticleContainer(0);
truthTracks->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_03_detLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "usedefault", AliJetContainer::antikt_algorithm, 0.3, AliJetContainer::kFullJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "detLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,EmbeddingHelper_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);

__R_ADDTASK__->GetClusterContainer(0)->SetClusNonLinCorrEnergyCut(0.);
__R_ADDTASK__->GetClusterContainer(0)->SetClusHadCorrEnergyCut(0.3);
__R_ADDTASK__->GetClusterContainer(0)->SetDefaultClusterEnergy(AliVCluster::kHadCorr);

// Setup the tracks properly to be retrieved from the external event
AliParticleContainer * tracks = __R_ADDTASK__->GetParticleContainer(0);
tracks->SetIsEmbedding(kTRUE);
tracks->SetParticlePtCut(0.15);
__R_ADDTASK__k->AdoptTrackContainer(tracks);


AliClusterContainer * clusters = __R_ADDTASK__->GetClusterContainer(0);
clusters->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_03_hybridLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "caloClustersCombined", AliJetContainer::antikt_algorithm, 0.3, AliJetContainer::kFullJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "hybridLevelJets_central", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,JetFinder_Full_AKT_03_detLevelJets_Embedding_MC_2018Kuma,JetFinder_Full_AKT_03_partLevelJets_Embedding_MC_2018Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
// This would be ideal for subwagons, but unfortunately they won't work for the jet finder.
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kIsRun2);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);

// Artificial tracking efficiency derived from the full jet R_AA paper.
// 10-30 \approx .99
// 0-10% \approx .98
// Apply only to embedded particles
__R_ADDTASK__->SetTrackEfficiency(.98);
__R_ADDTASK__->SetTrackEfficiencyOnlyForEmbedding(kTRUE);

// Particle containers
AliTrackContainer * tracksDetLevel = new AliTrackContainer("tracks");
// Get the det level tracks from the external event!
tracksDetLevel->SetIsEmbedding(kTRUE);
tracksDetLevel->SetParticlePtCut(3.);
__R_ADDTASK__->AdoptTrackContainer(tracksDetLevel);

// Cluster containers
__R_ADDTASK__->GetClusterContainer(0)->SetDefaultClusterEnergy(AliVCluster::kHadCorr);
__R_ADDTASK__->GetClusterContainer(0)->SetClusTimeCut(-50e-9, 100e-9);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_03_partLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "mcparticles", "", AliJetContainer::antikt_algorithm, 0.3, AliJetContainer::kFullJet, 0, 0.3, 0.005, AliJetContainer::E_scheme, "partLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);


// Setup the tracks properly to be retrieved from the external event
AliMCParticleContainer * truthTracks = __R_ADDTASK__->GetMCParticleContainer(0);
truthTracks->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_04_detLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "usedefault", AliJetContainer::antikt_algorithm, 0.4, AliJetContainer::kFullJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "detLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,EmcalCorrectionTask_Embedding_ClusterLevel_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);

__R_ADDTASK__->GetClusterContainer(0)->SetClusNonLinCorrEnergyCut(0.);
__R_ADDTASK__->GetClusterContainer(0)->SetClusHadCorrEnergyCut(0.3);
__R_ADDTASK__->GetClusterContainer(0)->SetDefaultClusterEnergy(AliVCluster::kHadCorr);

// Setup the tracks properly to be retrieved from the external event
AliParticleContainer * tracks = __R_ADDTASK__->GetParticleContainer(0);
tracks->SetIsEmbedding(kTRUE);
tracks->SetParticlePtCut(0.15);
__R_ADDTASK__k->AdoptTrackContainer(tracks);


AliClusterContainer * clusters = __R_ADDTASK__->GetClusterContainer(0);
clusters->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_04_hybridLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "caloClustersCombined", AliJetContainer::antikt_algorithm, 0.4, AliJetContainer::kFullJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "hybridLevelJets_central", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,JetFinder_Full_AKT_04_detLevelJets_Embedding_MC_2018Kuma,JetFinder_Full_AKT_04_partLevelJets_Embedding_MC_2018Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
// This would be ideal for subwagons, but unfortunately they won't work for the jet finder.
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kIsRun2);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);

// Artificial tracking efficiency derived from the full jet R_AA paper.
// 10-30 \approx .99
// 0-10% \approx .98
// Apply only to embedded particles
__R_ADDTASK__->SetTrackEfficiency(.98);
__R_ADDTASK__->SetTrackEfficiencyOnlyForEmbedding(kTRUE);

// Particle containers
AliTrackContainer * tracksDetLevel = new AliTrackContainer("tracks");
// Get the det level tracks from the external event!
tracksDetLevel->SetIsEmbedding(kTRUE);
tracksDetLevel->SetParticlePtCut(3.);
__R_ADDTASK__->AdoptTrackContainer(tracksDetLevel);

// Cluster containers
__R_ADDTASK__->GetClusterContainer(0)->SetDefaultClusterEnergy(AliVCluster::kHadCorr);
__R_ADDTASK__->GetClusterContainer(0)->SetClusTimeCut(-50e-9, 100e-9);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_04_partLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "mcparticles", "", AliJetContainer::antikt_algorithm, 0.3, AliJetContainer::kFullJet, 0, 0.3, 0.005, AliJetContainer::E_scheme, "partLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AAliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);


// Setup the tracks properly to be retrieved from the external event
AliMCParticleContainer * truthTracks = __R_ADDTASK__->GetMCParticleContainer(0);
truthTracks->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_05_detLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "usedefault", AliJetContainer::antikt_algorithm, 0.5, AliJetContainer::kFullJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "detLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);

__R_ADDTASK__->GetClusterContainer(0)->SetClusNonLinCorrEnergyCut(0.);
__R_ADDTASK__->GetClusterContainer(0)->SetClusHadCorrEnergyCut(0.3);
__R_ADDTASK__->GetClusterContainer(0)->SetDefaultClusterEnergy(AliVCluster::kHadCorr);

// Setup the tracks properly to be retrieved from the external event
AliParticleContainer * tracks = __R_ADDTASK__->GetParticleContainer(0);
tracks->SetIsEmbedding(kTRUE);
__R_ADDTASK__k->AdoptTrackContainer(tracks;


AliClusterContainer * clusters = __R_ADDTASK__->GetClusterContainer(0);
clusters->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_05_hybridLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "usedefault", "caloClustersCombined", AliJetContainer::antikt_algorithm, 0.5, AliJetContainer::kFullJet, 0.15, 3.0, kGhostArea, AliJetContainer::pt_scheme, "hybridLevelJets_central", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,JetFinder_Full_AKT_05_detLevelJets_Embedding_MC_2018Kuma,JetFinder_Full_AKT_05_partLevelJets_Embedding_MC_2018Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
// This would be ideal for subwagons, but unfortunately they won't work for the jet finder.
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kIsRun2);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);

// Artificial tracking efficiency derived from the full jet R_AA paper.
// 10-30 \approx .99
// 0-10% \approx .98
// Apply only to embedded particles
__R_ADDTASK__->SetTrackEfficiency(.98);
__R_ADDTASK__->SetTrackEfficiencyOnlyForEmbedding(kTRUE);

// Particle containers
AliTrackContainer * tracksDetLevel = new AliTrackContainer("tracks");
// Get the det level tracks from the external event!
tracksDetLevel->SetIsEmbedding(kTRUE);
tracksDetLevel->SetParticlePtCut(3.);
__R_ADDTASK__->AdoptTrackContainer(tracksDetLevel);

// Cluster containers
__R_ADDTASK__->GetClusterContainer(0)->SetDefaultClusterEnergy(AliVCluster::kHadCorr);
__R_ADDTASK__->GetClusterContainer(0)->SetClusTimeCut(-50e-9, 100e-9);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        JetFinder_Full_AKT_05_partLevelJets_Embedding_MC_2018Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskEmcalJet.C
#Module.MacroArgs    "mcparticles", "", AliJetContainer::antikt_algorithm, 0.5, AliJetContainer::kFullJet, 0, 0.3, 0.005, AliJetContainer::E_scheme, "partLevelJets", 0., kFALSE, kFALSE
#Module.Deps         ConfigureEmbeddingHelper_2018_Kuma,ConfigureEmcalCorrectionTask_Embedding_2018_Kuma,EmbeddingHelper_2018_Kuma,MultSelectionTask
#Module.Owner        tkumaoka
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);
__R_ADDTASK__->SetUseNewCentralityEstimation(kTRUE);


// Setup the tracks properly to be retrieved from the external event
AliMCParticleContainer * truthTracks = __R_ADDTASK__->GetMCParticleContainer(0);
truthTracks->SetIsEmbedding(kTRUE);

// Recycle unused embedded events
__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        MultSelectionTask
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/OADB/COMMON/MULTIPLICITY/macros/AddTaskMultSelection.C
#Module.MacroArgs    kFALSE
#Module.Deps         CDBConnectTask
#Module.Owner        mfasel
#Module.OutputFile   AnalysisResults.root
#Module.StartConfig
__R_ADDTASK__->SelectCollisionCandidates(kComPhysSel);

/* Actually the multiplicity task does need to run on AODs as well
if (strcmp(kDatatype,"AOD")==0) { // AOD data sets don't need centrality task
  cout << "*** Removing centrality task because AOD dataset" << endl;
  AliAnalysisManager *mgr = AliAnalysisManager::GetAnalysisManager();
  TObjArray *array = mgr->GetTasks();
  array->Remove(__R_ADDTASK__);
}
*/
#Module.EndConfig

#_______________________________________________________________________________
#Module.Begin        RhoTask_Embedding_Kuma
#Module.Libs         
#Module.DataTypes    ESD, AOD, MC
#Module.MacroName    $ALICE_PHYSICS/PWGJE/EMCALJetTasks/macros/AddTaskRhoNew.C
#Module.MacroArgs    "usedefault", "", "Rho", 0.4, AliEmcalJet::kTPCfid, AliJetContainer::kChargedJet, kFALSE, AliJetContainer::pt_scheme
#Module.Deps         JetFinder_charged_KT_04_Embedding_Kuma
#Module.Owner        tkumaoka
#Module.OutputFile   EventStat_temp.root
#Module.StartConfig
__R_ADDTASK__->SetExcludeLeadJets(2);
__R_ADDTASK__->SetUseNewCentralityEstimation(kIsRun2);
__R_ADDTASK__->SetNCentBins(10);
__R_ADDTASK__->SetCentRange(0,100);
__R_ADDTASK__->SelectCollisionCandidates(AliVEvent::kINT7);
__R_ADDTASK__->LoadRhoFunction("alien:///alice/cern.ch/user/t/tkumaoka/scaleFactorEMCalLHC18q_cell100.root", "fScaleFactorEMCal");
__R_ADDTASK__->SetForceBeamType(AliAnalysisTaskEmcal::kAA);

__R_ADDTASK__->SetRecycleUnusedEmbeddedEventsMode(true);//Embedding
#Module.EndConfig

